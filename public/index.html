<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Sholat - Bimas Islam RI</title>
    <style>
        :root { --green: #1a5d1a; --light: #f4f4f4; }
        body { font-family: sans-serif; background: var(--light); padding: 20px; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 360px; }
        .search-area { position: relative; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        #suggestions { position: absolute; background: white; width: 100%; border: 1px solid #ddd; z-index: 10; display: none; max-height: 200px; overflow-y: auto; }
        .city-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .city-item:hover { background: #f0f0f0; }
        .time-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .label { font-weight: bold; color: #555; text-transform: uppercase; }
        .time { font-weight: 900; color: var(--green); }
        .footer { font-size: 0.7rem; color: #999; text-align: center; margin-top: 20px; }
        .error { color: red; text-align: center; margin-top: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="card">
    <h3 id="cityLabel" style="text-align:center; color: var(--green);">DKI JAKARTA</h3>

    <div class="search-area">
        <input type="text" id="cityInput" placeholder="Ketik nama kota..." autocomplete="off">
        <div id="suggestions"></div>
    </div>

    <div id="errorBox" class="error"></div>
    <div id="times"></div>

    <div class="footer">Data: Official Bimas Islam Kemenag RI</div>
</div>

<script>
    // These are official Kemenag Codes (ProvID + CityID)
    const CITIES = [
        { id: "1301", name: "DKI JAKARTA" },
        { id: "1210", name: "KOTA BANDUNG" },
        { id: "1524", name: "KOTA SURABAYA" },
        { id: "1409", name: "KOTA SEMARANG" },
        { id: "1107", name: "KOTA MEDAN" },
        { id: "3171", name: "KOTA MAKASSAR" },
        { id: "1609", name: "KOTA YOGYAKARTA" },
        { id: "1211", name: "KOTA DEPOK" },
        { id: "1202", name: "KOTA BOGOR" },
        { id: "1708", name: "KOTA MALANG" }
    ];

    const input = document.getElementById('cityInput');
    const suggest = document.getElementById('suggestions');

    input.addEventListener('input', () => {
        const val = input.value.toUpperCase();
        if (val.length < 2) { suggest.style.display = 'none'; return; }
        const matches = CITIES.filter(c => c.name.includes(val));
        suggest.innerHTML = matches.map(c => `<div class="city-item" onclick="getTimes('${c.id}','${c.name}')">${c.name}</div>`).join('');
        suggest.style.display = matches.length ? 'block' : 'none';
    });

    async function getTimes(id, name) {
        input.value = name;
        suggest.style.display = 'none';
        document.getElementById('errorBox').innerText = "";

        try {
            const res = await fetch(`/.netlify/functions/index?city=${id}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('errorBox').innerText = data.error;
                return;
            }

            document.getElementById('cityLabel').innerText = name;
            const prayers = ['imsak', 'subuh', 'dzuhur', 'ashar', 'maghrib', 'isya'];
            document.getElementById('times').innerHTML = prayers.map(p => `
                <div class="time-row">
                    <span class="label">${p}</span>
                    <span class="time">${data.jadwal[p]}</span>
                </div>
            `).join('');
        } catch (e) {
            document.getElementById('errorBox').innerText = "Koneksi ke Kemenag Terputus.";
        }
    }

    window.onload = () => getTimes("1301", "DKI JAKARTA");
</script>
</body>
</html>
